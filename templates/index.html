<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AI Safety Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>🎯 AI Safety System</h1>
      <p class="subtitle">Live people detection · 3D-ish density · fallen & fire alerts · real-time mini-map</p>
    </header>

    <div class="dashboard">
      <div class="left-col">
        <div class="card">
          <h2>📂 Select Video</h2>
          <label for="videoDropdown">Choose a file to simulate CCTV:</label>
          <select id="videoDropdown" class="dropdown">
            <option value="">-- choose --</option>
            {% for v in videos %}
              <option value="{{ v }}">{{ v }}</option>
            {% endfor %}
          </select>
          <div class="control-buttons" style="margin-top:12px;">
            <button id="selectVideoBtn" class="btn btn-primary">Load Video</button>
            <button id="playBtn" class="btn btn-info" style="display:none;">Start View</button>
            <button id="pauseBtn" class="btn btn-warning" style="display:none;">Stop View</button>
          </div>

          <div id="videoInfo" class="video-info" style="display:none;margin-top:12px;">
            <h3>📊 Info</h3>
            <div class="info-grid">
              <div class="info-item"><span class="label">Name</span><span id="videoName">-</span></div>
              <div class="info-item"><span class="label">Mode</span><span id="videoMode">-</span></div>
              <div class="info-item"><span class="label">FPS</span><span id="videoFPS">-</span></div>
              <div class="info-item"><span class="label">Frames</span><span id="videoFrameCount">-</span></div>
            </div>
          </div>
        </div>

        <div class="card" id="detectionCard" style="display:none;">
          <h2>🧍 Detection & Density</h2>
          <div class="detection-stats top-stats">
            <div class="stat-item"><div class="stat-label">People</div><div id="peopleCount" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-label">Proc FPS</div><div id="procFps" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-label">Density</div><div id="densityLevel" class="stat-value">LOW</div></div>
            <div class="stat-item"><div class="stat-label">Per Cell</div><div id="densityValue" class="stat-value">0</div></div>
          </div>

          <div class="frame-display">
            <div class="video-wrap">
              <img id="processedFrame" alt="Processed frame" style="display:none;"/>
            </div>
            <div class="info-box">
              <h4>Stream Status</h4>
              <div class="status-display">
                <div class="status-item"><span class="status-dot active" id="stateDot"></span><div><div class="status-label">State</div><div id="streamState" class="status-value">Idle</div></div></div>
                <div class="status-item"><span class="status-dot"></span><div><div class="status-label">Last Frame</div><div id="lastFrame" class="status-value">—</div></div></div>
                <div class="status-item"><span class="status-dot"></span><div><div class="status-label">Detections</div><div id="lastDetections" class="status-value">—</div></div></div>
              </div>
              <h4 style="margin-top:8px;">3D-ish Positions</h4>
              <div id="positions3D" class="status-value">—</div>
            </div>
          </div>
        </div>

        <div class="card" id="anomalyCard" style="display:none;">
          <h2>⚠️ Anomalies</h2>
          <div class="anomaly-stats">
            <div class="stat-item"><div class="stat-label">Fallen</div><div id="fallenCount" class="stat-value">0</div></div>
            <div class="stat-item"><div class="stat-label">Fire Score</div><div id="fireRisk" class="stat-value">0.00</div></div>
            <div class="stat-item"><div class="stat-label">Fire Regions</div><div id="fireRegions" class="stat-value">0</div></div>
          </div>
          <div class="anomaly-details" id="anomalyDetails"></div>
        </div>
      </div>

      <aside class="right-col">
        <div class="card mini-map-card">
          <div class="flex-row" style="display:flex;justify-content:space-between;align-items:center;">
            <h2>🗺️ Mini Map (Live)</h2>
            <div><button id="toggleMini" class="btn btn-info">Toggle</button></div>
          </div>
          <p class="muted">Top-down positions with IDs and headings</p>
          <div class="mini-map-wrap">
            <canvas id="miniMapCanvas" width="360" height="280"></canvas>
          </div>
        </div>

        <div class="card">
          <h2>🚀 Features</h2>
          <div class="feature-list">
            <div class="feature-item completed">✅ YOLO People Detection</div>
            <div class="feature-item completed">✅ Width/Height Fallen Detection</div>
            <div class="feature-item completed">✅ HSV+Flicker Fire Detection</div>
            <div class="feature-item completed">✅ Live Mini-map with Heading</div>
            <div class="feature-item completed">✅ Density Estimation</div>
          </div>
        </div>
      </aside>
    </div>

    <div id="toast" class="toast"></div>
  </div>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
